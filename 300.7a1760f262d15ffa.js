"use strict";(self.webpackChunkclipit=self.webpackChunkclipit||[]).push([[300],{1300:(pe,T,l)=>{l.r(T),l.d(T,{VideoModule:()=>se});var c=l(9808),a=l(3075),L=l(4466),g=l(9100),b=l(1135),p=l(7579),U=l(9841),e=l(5e3),h=l(9541),D=l(1609),I=l(276),m=l(5861),$=l(8549),S=l(235);function k(o,r){if(1&o&&(e.TgZ(0,"app-alert",9)(1,"p"),e._uU(2),e.qZA()()),2&o){const t=e.oxw().$implicit;e.Q6J("color",t.color),e.xp6(2),e.Oqu(t.msg)}}function M(o,r){if(1&o&&(e.ynx(0),e.YNc(1,k,3,2,"app-alert",8),e.BQk()),2&o){const t=r.$implicit;e.xp6(1),e.Q6J("ngIf",t.show)}}const E=function(o,r){return{"opacity-50":o,"hover:bg-indigo-700":r}};let F=(()=>{class o{constructor(t){this.clipService=t,this._clip=null,this.update=new e.vpe,this.alert$=new p.x,this.isProcessingRequest$=new p.x,this.clipId=new a.NI("",[a.kI.required]),this.title=new a.NI("",[a.kI.required,a.kI.minLength(3)]),this.editForm=new a.cw({title:this.title,id:this.clipId})}set clip(t){console.log("Nam data is: setting new clip",t),this._clip=t,this.clip&&(this.clipId.setValue(this.clip.docID),this.title.setValue(this.clip.title),this.alert$.next(null))}get clip(){return this._clip}onEditFormSubmit(){var t=this;return(0,m.Z)(function*(){if(t.clip){t.isProcessingRequest$.next(!0),t.alert$.next({show:!0,msg:"Please wait while we're updating your clip",color:"blue"});try{yield t.clipService.updateClip({docID:t.clipId.value,title:t.title.value})}catch(n){return t.isProcessingRequest$.next(!1),void t.alert$.next({show:!0,color:"red",msg:"Something went wrong. Please try again later"})}t.clip.title=t.title.value,t.update.emit(t.clip),t.isProcessingRequest$.next(!1),t.alert$.next({show:!0,color:"green",msg:"Success! Your clip is now updated"})}})()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(h.Y))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-edit"]],inputs:{clip:"clip"},outputs:{update:"update"},decls:15,vars:16,consts:[[1,"text-2xl","font-bold"],[4,"ngIf"],[3,"formGroup","ngSubmit"],[1,"mt-4"],[1,"block","text-xl","mb-4"],["placeHolder","Enter title",3,"control"],[1,"mt-4","text-right"],["type","submit",1,"inline-flex","justify-center","py-2","px-4","border","border-transparent","shadow-sm","rounded-md","text-white","bg-indigo-600","focus:outline-none",3,"disabled","ngClass"],[3,"color",4,"ngIf"],[3,"color"]],template:function(t,n){1&t&&(e.TgZ(0,"p",0),e._uU(1,"Edit Video"),e.qZA(),e.YNc(2,M,2,1,"ng-container",1),e.ALo(3,"async"),e.TgZ(4,"form",2),e.NdJ("ngSubmit",function(){return n.onEditFormSubmit()}),e.TgZ(5,"div",3)(6,"label",4),e._uU(7,"Title"),e.qZA(),e._UZ(8,"app-input",5),e.qZA(),e.TgZ(9,"div",6)(10,"button",7),e.ALo(11,"async"),e.ALo(12,"async"),e.ALo(13,"async"),e._uU(14," Update "),e.qZA()()()),2&t&&(e.xp6(2),e.Q6J("ngIf",e.lcZ(3,5,n.alert$)),e.xp6(2),e.Q6J("formGroup",n.editForm),e.xp6(4),e.Q6J("control",n.title),e.xp6(2),e.Q6J("disabled",e.lcZ(11,7,n.isProcessingRequest$))("ngClass",e.WLB(13,E,e.lcZ(12,9,n.isProcessingRequest$),!1===e.lcZ(13,11,n.isProcessingRequest$))))},directives:[c.O5,$.w,a._Y,a.JL,a.sg,S.a,c.mk],pipes:[c.Ov],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0}),o})();function J(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",11)(1,"a",12),e._UZ(2,"img",13),e.qZA(),e.TgZ(3,"div",14)(4,"a",15),e._uU(5),e.qZA(),e.TgZ(6,"a",16),e._uU(7," Copy Link "),e.qZA()(),e.TgZ(8,"div",17)(9,"a",18),e.NdJ("click",function(i){const d=e.CHM(t).$implicit;return e.oxw().onEditLinkClick(i,d)}),e.TgZ(10,"span",19),e._uU(11,"build"),e.qZA()(),e.TgZ(12,"a",20),e.NdJ("click",function(i){const d=e.CHM(t).$implicit;return e.oxw().onDeleteLinkClick(i,d)}),e.TgZ(13,"span",19),e._uU(14,"delete"),e.qZA()()()()}if(2&o){const t=r.$implicit;e.xp6(2),e.Q6J("src",t.screenshotURL,e.LSH),e.xp6(3),e.hij(" ",t.title," ")}}let O=(()=>{class o{constructor(t,n,i,s){this.router=t,this.activatedRouter=n,this.clipService=i,this.modalService=s,this.EDIT_MODAL_ID="editModal",this.videosSortOrder="asc",this.clips$=new b.X([]),this.activeClip$=new p.x}ngOnInit(){(0,U.a)([this.activatedRouter.queryParamMap,this.clipService.getUserClips()]).subscribe(([t,n])=>{const i=t.get("sort");i&&("asc"===i||"desc"===i)&&(this.videosSortOrder=i),n&&(n.sort((s,d)=>"desc"===this.videosSortOrder?s.timestamp.seconds-d.timestamp.seconds:d.timestamp.seconds-s.timestamp.seconds),this.clips$.next(null!=n?n:[]))})}sort(t){const{value:n}=t.target;this.router.navigate([],{relativeTo:this.activatedRouter,queryParams:{sort:n}})}onEditLinkClick(t,n){t.preventDefault(),this.activeClip$.next(Object.assign({},n)),this.modalService.showModal(this.EDIT_MODAL_ID)}onDeleteLinkClick(t,n){t.preventDefault(),this.clipService.deleteClip(n).subscribe({next:()=>{const i=this.clips$.getValue().filter(s=>s.docID!==n.docID);this.clips$.next(i)}})}onClipUpdate(t){const n=this.clips$.getValue(),i=n.findIndex(s=>s.docID===t.docID);n[i]=Object.assign(Object.assign({},n[i]),t),this.clips$.next(n)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(g.F0),e.Y36(g.gz),e.Y36(h.Y),e.Y36(D.Z))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-manage"]],decls:16,vars:9,consts:[[1,"container","mx-auto","my-8","bg-secondary","p-6"],[1,"rounded","relative","flex","justify-between"],["routerLink","/video/upload",1,"bg-indigo-400","text-white","py-4","px-10","text-xl"],[1,"text-black","px-8","text-xl","outline-none","appearance-none",3,"change"],["value","asc",3,"selected"],["value","desc",3,"selected"],[1,"container","mx-auto","my-8"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-4"],["class","mt-6 rounded-tl-2xl rounded-br-2xl shadow-xl bg-secondary flex flex-col justify-start",4,"ngFor","ngForOf"],[3,"id"],[3,"clip","update"],[1,"mt-6","rounded-tl-2xl","rounded-br-2xl","shadow-xl","bg-secondary","flex","flex-col","justify-start"],["href","#"],["crossorigin","",1,"card-img-top","rounded-tl-2xl","w-full",3,"src"],[1,"p-6","text-2xl"],["href","#",1,"font-bold","mb-2"],["href","#",1,"bg-gray-400","text-white","px-2","py-1","ml-2","text-sm","rounded"],[1,"flex","text-center","text-2xl","bg-gray-800","p-2","mt-auto"],["href","#",1,"flex-1","p-2","border-right","border-r-2","border-gray-700","transition","hover:text-indigo-400",3,"click"],[1,"material-icons","text-base"],["href","#",1,"flex-1","p-2","rounded-br-2xl","transition","hover:text-indigo-400",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"section",0)(1,"div",1)(2,"a",2),e._uU(3,"Upload Videos"),e.qZA(),e.TgZ(4,"select",3),e.NdJ("change",function(s){return n.sort(s)}),e.TgZ(5,"option",4),e._uU(6," Recent Uploads "),e.qZA(),e.TgZ(7,"option",5),e._uU(8," Oldest Uploads "),e.qZA()()()(),e.TgZ(9,"div",6)(10,"div",7),e.YNc(11,J,15,2,"div",8),e.ALo(12,"async"),e.qZA()(),e.TgZ(13,"app-modal",9)(14,"app-edit",10),e.NdJ("update",function(s){return n.onClipUpdate(s)}),e.ALo(15,"async"),e.qZA()()),2&t&&(e.xp6(5),e.Q6J("selected","asc"===n.videosSortOrder),e.xp6(2),e.Q6J("selected","desc"===n.videosSortOrder),e.xp6(4),e.Q6J("ngForOf",e.lcZ(12,5,n.clips$)),e.xp6(2),e.Q6J("id",n.EDIT_MODAL_ID),e.xp6(1),e.Q6J("clip",e.lcZ(15,7,n.activeClip$)))},directives:[g.yS,a.YN,a.Kr,c.sg,I.z,F],pipes:[c.Ov],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0}),o})();var P=l(127),w=l(9646),R=l(4004),A=l(4128),N=l(3900),Y=l(7556),Q=l(6161);let q=(()=>{class o{handleEvent(t){t.preventDefault()}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275dir=e.lG2({type:o,selectors:[["","appEventBlocker",""]],hostBindings:function(t,n){1&t&&e.NdJ("drop",function(s){return n.handleEvent(s)})("dragover",function(s){return n.handleEvent(s)})}}),o})();var B=l(2313);let V=(()=>{class o{constructor(t){this.domSanitizer=t}transform(t){return this.domSanitizer.bypassSecurityTrustUrl(t)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(B.H7,16))},o.\u0275pipe=e.Yjl({name:"safeURL",type:o,pure:!0}),o})();const H=function(o){return{"bg-indigo-400 border-indigo-400 border-solid":o}};function j(o,r){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",6),e.NdJ("dragend",function(){return e.CHM(t),e.oxw(2).isDragOver=!1})("dragover",function(){return e.CHM(t),e.oxw(2).isDragOver=!0})("dragenter",function(){return e.CHM(t),e.oxw(2).isDragOver=!0})("dragleave",function(){return e.CHM(t),e.oxw(2).isDragOver=!1})("mouseleave",function(){return e.CHM(t),e.oxw(2).isDragOver=!1})("drop",function(i){return e.CHM(t),e.oxw(2).onFileDrop(i)}),e.TgZ(2,"h5"),e._uU(3,"Drop your file here (mp4 only!)"),e.qZA()(),e.TgZ(4,"input",7),e.NdJ("change",function(i){return e.CHM(t),e.oxw(2).onFileSelect(i)}),e.qZA(),e.BQk()}if(2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("ngClass",e.VKq(1,H,t.isDragOver))}}function G(o,r){if(1&o&&(e.ynx(0),e.YNc(1,j,5,3,"ng-container",3),e.ALo(2,"async"),e.ALo(3,"async"),e.BQk()),2&o){const t=e.oxw(),n=e.MAs(8);e.xp6(1),e.Q6J("ngIf",e.lcZ(2,2,t.ffmpegSevice.isReady$)&&!0!==e.lcZ(3,4,t.isProcessingVideo$))("ngIfElse",n)}}function z(o,r){if(1&o&&(e.TgZ(0,"p"),e._uU(1),e.ALo(2,"percent"),e.qZA()),2&o){const t=r.$implicit;e.xp6(1),e.hij(" ",e.lcZ(2,1,t)," ")}}function X(o,r){if(1&o&&(e.TgZ(0,"app-alert",19)(1,"p"),e._uU(2),e.qZA(),e.YNc(3,z,3,3,"p",8),e.ALo(4,"async"),e.qZA()),2&o){const t=e.oxw().$implicit,n=e.oxw(2);e.Q6J("color",t.color),e.xp6(2),e.Oqu(t.msg),e.xp6(1),e.Q6J("ngIf",e.lcZ(4,3,n.uploadPercentage$))}}function W(o,r){if(1&o&&(e.ynx(0),e.YNc(1,X,5,5,"app-alert",18),e.BQk()),2&o){const t=r.$implicit;e.xp6(1),e.Q6J("ngIf",t.show)}}const K=function(o,r){return{"border-green-400":o,"border-transparent":r}};function ee(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",20),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.oxw(2).selectedScreenshot$.next(s)}),e.ALo(1,"async"),e.ALo(2,"async"),e._UZ(3,"img",21),e.ALo(4,"safeURL"),e.qZA()}if(2&o){const t=r.$implicit,n=e.oxw(2);e.Q6J("ngClass",e.WLB(8,K,t===e.lcZ(1,2,n.selectedScreenshot$),t!==e.lcZ(2,4,n.selectedScreenshot$))),e.xp6(3),e.Q6J("src",e.lcZ(4,6,t),e.LSH)}}const te=function(o,r){return{"opacity-50":o,"hover:bg-indigo-700":r}};function ne(o,r){if(1&o){const t=e.EpF();e.YNc(0,W,2,1,"ng-container",8),e.ALo(1,"async"),e.TgZ(2,"form",9),e.NdJ("ngSubmit",function(){return e.CHM(t),e.oxw().uploadFile()}),e.TgZ(3,"h2",10),e._uU(4,"Select a Thumbnail"),e.qZA(),e.TgZ(5,"div",11),e.YNc(6,ee,5,11,"div",12),e.ALo(7,"async"),e.qZA(),e.TgZ(8,"div",13)(9,"label",14),e._uU(10,"Title"),e.qZA(),e._UZ(11,"app-input",15),e.qZA(),e.TgZ(12,"div",16)(13,"button",17),e.ALo(14,"async"),e.ALo(15,"async"),e.ALo(16,"async"),e._uU(17," Publish "),e.qZA()()()}if(2&o){const t=e.oxw();e.Q6J("ngIf",e.lcZ(1,6,t.alert$)),e.xp6(2),e.Q6J("formGroup",t.uploadForm),e.xp6(4),e.Q6J("ngForOf",e.lcZ(7,8,t.screenshots$)),e.xp6(5),e.Q6J("control",t.title),e.xp6(2),e.Q6J("disabled",e.lcZ(14,10,t.isProcessingRequest$))("ngClass",e.WLB(16,te,e.lcZ(15,12,t.isProcessingRequest$),!1===e.lcZ(16,14,t.isProcessingRequest$)))}}function oe(o,r){1&o&&(e.TgZ(0,"span",22),e._uU(1," settings "),e.qZA())}const ie=[{path:"manage",component:O},{path:"upload",component:(()=>{class o{constructor(t,n,i,s){this.authService=t,this.clipService=n,this.router=i,this.ffmpegSevice=s,this.CLIP_UPLOADING_MESSAGE="Please wait! Your clip is being uploaded",this.isDragOver=!1,this.file=null,this.user=null,this.screenshots$=(0,w.of)([]),this.isProcessingVideo$=new p.x,this.selectedScreenshot$=new b.X(null),this.alert$=new p.x,this.formEnabled=!1,this.title=new a.NI("",[a.kI.required,a.kI.minLength(3)]),this.uploadForm=new a.cw({title:this.title}),this.isProcessingRequest$=new p.x,this.uploadPercentage$=new p.x,this.videoUploadTask=null,this.screenshotUploadTask=null,this.authService.user$.subscribe(d=>this.user=d),this.ffmpegSevice.init()}ngOnDestroy(){this.videoUploadTask&&this.videoUploadTask.cancel(),this.screenshotUploadTask&&this.screenshotUploadTask.cancel()}onFileDrop(t){var n,i;this.isDragOver=!1;const s=null!==(i=null===(n=t.dataTransfer)||void 0===n?void 0:n.files[0])&&void 0!==i?i:null;this.setFile(s)}onFileSelect(t){var n,i;const s=null!==(i=null===(n=t.target.files)||void 0===n?void 0:n[0])&&void 0!==i?i:null;this.setFile(s)}setFile(t){var n=this;return(0,m.Z)(function*(){var i;if(!t)return;if(n.file=t,"video/mp4"!==n.file.type)return void console.log("Nam data is: ",null===(i=n.file)||void 0===i?void 0:i.type);n.isProcessingVideo$.next(!0);const s=yield n.ffmpegSevice.getScreenShots(n.file);n.screenshots$=(0,w.of)(s),n.selectedScreenshot$.next(s[0]),n.isProcessingVideo$.next(!0),n.title.setValue(n.file.name.replace(/\.[^/.]+$/,"")),n.formEnabled=!0})()}uploadFile(){var t=this;return(0,m.Z)(function*(){if(!t.file)return;t.uploadForm.disable(),t.alert$.next({show:!0,color:"blue",msg:t.CLIP_UPLOADING_MESSAGE}),t.isProcessingRequest$.next(!0);const n=yield t.ffmpegSevice.blobFromURL(t.selectedScreenshot$.getValue()),[i,s]=t.clipService.uploadClip(t.file);t.videoUploadTask=i;const[d,f]=t.clipService.uploadScreenshot(n);var u;t.screenshotUploadTask=d,(0,U.a)([t.videoUploadTask.percentageChanges(),t.screenshotUploadTask.percentageChanges()]).pipe((0,R.U)(([u,_])=>((u||0)+(_||0))/200)).subscribe(u=>t.uploadPercentage$.next(u)),(0,A.D)([t.videoUploadTask.snapshotChanges(),t.screenshotUploadTask.snapshotChanges()]).pipe((0,N.w)(()=>(0,A.D)([s.getDownloadURL(),s.getMetadata(),f.getDownloadURL(),f.getMetadata()]))).subscribe({next:(u=(0,m.Z)(function*([_,v,le,ae]){var x,y,C,Z;t.isProcessingRequest$.next(!1);const ce={uid:null!==(y=null===(x=t.user)||void 0===x?void 0:x.uuid)&&void 0!==y?y:"unknow",displayName:null!==(Z=null===(C=t.user)||void 0===C?void 0:C.name)&&void 0!==Z?Z:"unknow user displayName",title:t.title.value,fileName:v.name,url:_,screenshotURL:le,screenshotFileName:ae.name,timestamp:P.Z.firestore.FieldValue.serverTimestamp()},de=yield t.clipService.createClip(ce);setTimeout(()=>{t.router.navigate(["clips",de.id])},1e3),t.alert$.next({color:"green",msg:"Success! Your clip is now ready to be shared with the world.",show:!0})}),function(v){return u.apply(this,arguments)}),error:u=>{t.isProcessingRequest$.next(!1),t.uploadForm.enable(),t.alert$.next({color:"red",msg:"Upload failed. Please try again later",show:!0}),console.log("Nam data is: ",u)}})})()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(Y.e),e.Y36(h.Y),e.Y36(g.F0),e.Y36(Q.s))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-upload"]],decls:9,vars:2,consts:[[1,"container","mx-auto","my-8","bg-secondary","p-6"],[1,"rounded","relative","flex","flex-col"],[1,"font-bold","mb-6"],[4,"ngIf","ngIfElse"],["uploadFormTpl",""],["loadingTpl",""],["appEventBlocker","",1,"w-full","px-10","py-40","rounded","text-center","cursor-pointer","border","border-dashed","border-gray-400","transition","duration-500","hover:text-white","hover:bg-indigo-400","hover:border-indigo-400","hover:border-solid","text-xl",3,"ngClass","dragend","dragover","dragenter","dragleave","mouseleave","drop"],["type","file",1,"mt-4",3,"change"],[4,"ngIf"],[3,"formGroup","ngSubmit"],[1,"mb-4","text-xl"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-4"],["class","border-8 cursor-pointer",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"mt-4"],[1,"block","text-xl","mb-4"],["placeHolder","Enter title",3,"control"],[1,"mt-4","text-right"],["type","submit",1,"inline-flex","justify-center","py-2","px-4","border","border-transparent","shadow-sm","rounded-md","text-white","bg-indigo-600","focus:outline-none",3,"disabled","ngClass"],[3,"color",4,"ngIf"],[3,"color"],[1,"border-8","cursor-pointer",3,"ngClass","click"],[3,"src"],[1,"material-symbols-outlined","text-center","text-6xl","p-8","animate-spin"]],template:function(t,n){if(1&t&&(e.TgZ(0,"section",0)(1,"div",1)(2,"div",2),e._uU(3,"Upload Video"),e.qZA(),e.YNc(4,G,4,6,"ng-container",3),e.YNc(5,ne,18,19,"ng-template",null,4,e.W1O),e.qZA()(),e.YNc(7,oe,2,0,"ng-template",null,5,e.W1O)),2&t){const i=e.MAs(6);e.xp6(4),e.Q6J("ngIf",!n.formEnabled)("ngIfElse",i)}},directives:[c.O5,q,c.mk,$.w,a._Y,a.JL,a.sg,c.sg,S.a],pipes:[c.Ov,c.Zx,V],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0}),o})()},{path:"manage-clips",redirectTo:"manage"}];let re=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[g.Bz.forChild(ie)],g.Bz]}),o})(),se=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[c.ez,re,L.m,a.UX]]}),o})()}}]);