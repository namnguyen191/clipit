"use strict";(self.webpackChunkclipit=self.webpackChunkclipit||[]).push([[604],{3604:(fe,T,s)=>{s.r(T),s.d(T,{VideoModule:()=>ue});var v,p=s(9808),a=s(2382),A=s(4466),g=s(991),S=s(1135),f=s(7579),h=s(4004),e=s(5e3),_=s(3900),$=s(9646),D=new Uint8Array(16);function F(){if(!v&&!(v="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return v(D)}const E=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,O=function L(n){return"string"==typeof n&&E.test(n)};for(var c=[],x=0;x<256;++x)c.push((x+256).toString(16).substr(1));const J=function N(n,r,t){var i=(n=n||{}).random||(n.rng||F)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,r){t=t||0;for(var o=0;o<16;++o)r[t+o]=i[o];return r}return function M(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=(c[n[r+0]]+c[n[r+1]]+c[n[r+2]]+c[n[r+3]]+"-"+c[n[r+4]]+c[n[r+5]]+"-"+c[n[r+6]]+c[n[r+7]]+"-"+c[n[r+8]]+c[n[r+9]]+"-"+c[n[r+10]]+c[n[r+11]]+c[n[r+12]]+c[n[r+13]]+c[n[r+14]]+c[n[r+15]]).toLowerCase();if(!O(t))throw TypeError("Stringified UUID is invalid");return t}(i)};var k=s(7566),R=s(1205),q=s(2084);let C=(()=>{class n{constructor(t,i,o){this.angularFirestore=t,this.angularFireAuth=i,this.angularFireStorage=o,this.CLIPS_COLLECTION_ID="clips",this._clipsCollection=this.angularFirestore.collection(this.CLIPS_COLLECTION_ID)}createClip(t){return this._clipsCollection.add(t)}uploadClip(t){const o=`clips/${J()}.mp4`;return[this.angularFireStorage.upload(o,t),this.angularFireStorage.ref(o)]}updateClip(t){return this._clipsCollection.doc(t.docID).update(t)}getUserClips(){return this.angularFireAuth.user.pipe((0,_.w)(t=>t?this._clipsCollection.ref.where("uid","==",t.uid).get():(0,$.of)(null)),(0,h.U)(t=>{var i;return null!==(i=null==t?void 0:t.docs)&&void 0!==i?i:null}))}deleteClip(t){return this.angularFireStorage.ref(`clips/${t.fileName}`).delete().pipe((0,_.w)(()=>this._clipsCollection.doc(t.docID).delete()))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(k.ST),e.LFG(R.zQ),e.LFG(q.Q1))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var Q=s(1609),V=s(276),w=s(5861),U=s(8549),I=s(235);function Y(n,r){if(1&n&&(e.TgZ(0,"app-alert",9)(1,"p"),e._uU(2),e.qZA()()),2&n){const t=e.oxw().$implicit;e.Q6J("color",t.color),e.xp6(2),e.Oqu(t.msg)}}function B(n,r){if(1&n&&(e.ynx(0),e.YNc(1,Y,3,2,"app-alert",8),e.BQk()),2&n){const t=r.$implicit;e.xp6(1),e.Q6J("ngIf",t.show)}}const j=function(n,r){return{"opacity-50":n,"hover:bg-indigo-700":r}};let H=(()=>{class n{constructor(t){this.clipService=t,this._clip=null,this.update=new e.vpe,this.alert$=new f.x,this.isProcessingRequest$=new f.x,this.clipId=new a.NI("",[a.kI.required]),this.title=new a.NI("",[a.kI.required,a.kI.minLength(3)]),this.editForm=new a.cw({title:this.title,id:this.clipId})}set clip(t){console.log("Nam data is: setting new clip",t),this._clip=t,this.clip&&(this.clipId.setValue(this.clip.docID),this.title.setValue(this.clip.title),this.alert$.next(null))}get clip(){return this._clip}onEditFormSubmit(){var t=this;return(0,w.Z)(function*(){if(t.clip){t.isProcessingRequest$.next(!0),t.alert$.next({show:!0,msg:"Please wait while we're updating your clip",color:"blue"});try{yield t.clipService.updateClip({docID:t.clipId.value,title:t.title.value})}catch(i){return t.isProcessingRequest$.next(!1),void t.alert$.next({show:!0,color:"red",msg:"Something went wrong. Please try again later"})}t.clip.title=t.title.value,t.update.emit(t.clip),t.isProcessingRequest$.next(!1),t.alert$.next({show:!0,color:"green",msg:"Success! Your clip is now updated"})}})()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(C))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-edit"]],inputs:{clip:"clip"},outputs:{update:"update"},decls:15,vars:16,consts:[[1,"text-2xl","font-bold"],[4,"ngIf"],[3,"formGroup","ngSubmit"],[1,"mt-4"],[1,"block","text-xl","mb-4"],["placeHolder","Enter title",3,"control"],[1,"mt-4","text-right"],["type","submit",1,"inline-flex","justify-center","py-2","px-4","border","border-transparent","shadow-sm","rounded-md","text-white","bg-indigo-600","focus:outline-none",3,"disabled","ngClass"],[3,"color",4,"ngIf"],[3,"color"]],template:function(t,i){1&t&&(e.TgZ(0,"p",0),e._uU(1,"Edit Video"),e.qZA(),e.YNc(2,B,2,1,"ng-container",1),e.ALo(3,"async"),e.TgZ(4,"form",2),e.NdJ("ngSubmit",function(){return i.onEditFormSubmit()}),e.TgZ(5,"div",3)(6,"label",4),e._uU(7,"Title"),e.qZA(),e._UZ(8,"app-input",5),e.qZA(),e.TgZ(9,"div",6)(10,"button",7),e.ALo(11,"async"),e.ALo(12,"async"),e.ALo(13,"async"),e._uU(14," Update "),e.qZA()()()),2&t&&(e.xp6(2),e.Q6J("ngIf",e.lcZ(3,5,i.alert$)),e.xp6(2),e.Q6J("formGroup",i.editForm),e.xp6(4),e.Q6J("control",i.title),e.xp6(2),e.Q6J("disabled",e.lcZ(11,7,i.isProcessingRequest$))("ngClass",e.WLB(13,j,e.lcZ(12,9,i.isProcessingRequest$),!1===e.lcZ(13,11,i.isProcessingRequest$))))},directives:[p.O5,U.w,a._Y,a.JL,a.sg,I.a,p.mk],pipes:[p.Ov],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0}),n})();function G(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",11)(1,"a",12),e._UZ(2,"img",13),e.qZA(),e.TgZ(3,"div",14)(4,"a",15),e._uU(5),e.qZA(),e.TgZ(6,"a",16),e._uU(7," Copy Link "),e.qZA()(),e.TgZ(8,"div",17)(9,"a",18),e.NdJ("click",function(o){const d=e.CHM(t).$implicit;return e.oxw().onEditLinkClick(o,d)}),e.TgZ(10,"span",19),e._uU(11,"build"),e.qZA()(),e.TgZ(12,"a",20),e.NdJ("click",function(o){const d=e.CHM(t).$implicit;return e.oxw().onDeleteLinkClick(o,d)}),e.TgZ(13,"span",19),e._uU(14,"delete"),e.qZA()()()()}if(2&n){const t=r.$implicit;e.xp6(5),e.hij(" ",t.title," ")}}let z=(()=>{class n{constructor(t,i,o,l){this.router=t,this.activatedRouter=i,this.clipService=o,this.modalService=l,this.EDIT_MODAL_ID="editModal",this.videosSortOrder="asc",this.clips$=new S.X([]),this.activeClip$=new f.x,this.clipService.getUserClips().pipe((0,h.U)(d=>{var u;return null!==(u=null==d?void 0:d.map(m=>Object.assign(Object.assign({},m.data()),{docID:m.id})))&&void 0!==u?u:null})).subscribe(d=>this.clips$.next(null!=d?d:[]))}ngOnInit(){this.activatedRouter.queryParamMap.subscribe(t=>{const i=t.get("sort");i&&("asc"===i||"desc"===i)&&(this.videosSortOrder=i)})}sort(t){const{value:i}=t.target;this.router.navigate([],{relativeTo:this.activatedRouter,queryParams:{sort:i}})}onEditLinkClick(t,i){t.preventDefault(),this.activeClip$.next(Object.assign({},i)),this.modalService.showModal(this.EDIT_MODAL_ID)}onDeleteLinkClick(t,i){t.preventDefault(),this.clipService.deleteClip(i).subscribe({next:()=>{const o=this.clips$.getValue().filter(l=>l.docID!==i.docID);this.clips$.next(o)}})}onClipUpdate(t){const i=this.clips$.getValue(),o=i.findIndex(l=>l.docID===t.docID);i[o]=Object.assign(Object.assign({},i[o]),t),this.clips$.next(i)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(g.F0),e.Y36(g.gz),e.Y36(C),e.Y36(Q.Z))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-manage"]],decls:16,vars:9,consts:[[1,"container","mx-auto","my-8","bg-secondary","p-6"],[1,"rounded","relative","flex","justify-between"],["routerLink","/video/upload",1,"bg-indigo-400","text-white","py-4","px-10","text-xl"],[1,"text-black","px-8","text-xl","outline-none","appearance-none",3,"change"],["value","asc",3,"selected"],["value","desc",3,"selected"],[1,"container","mx-auto","my-8"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-4"],["class","mt-6 rounded-tl-2xl rounded-br-2xl shadow-xl bg-secondary flex flex-col justify-start",4,"ngFor","ngForOf"],[3,"id"],[3,"clip","update"],[1,"mt-6","rounded-tl-2xl","rounded-br-2xl","shadow-xl","bg-secondary","flex","flex-col","justify-start"],["href","#"],["src","assets/img/1.jpg",1,"card-img-top","rounded-tl-2xl","w-full"],[1,"p-6","text-2xl"],["href","#",1,"font-bold","mb-2"],["href","#",1,"bg-gray-400","text-white","px-2","py-1","ml-2","text-sm","rounded"],[1,"flex","text-center","text-2xl","bg-gray-800","p-2","mt-auto"],["href","#",1,"flex-1","p-2","border-right","border-r-2","border-gray-700","transition","hover:text-indigo-400",3,"click"],[1,"material-icons","text-base"],["href","#",1,"flex-1","p-2","rounded-br-2xl","transition","hover:text-indigo-400",3,"click"]],template:function(t,i){1&t&&(e.TgZ(0,"section",0)(1,"div",1)(2,"a",2),e._uU(3,"Upload Videos"),e.qZA(),e.TgZ(4,"select",3),e.NdJ("change",function(l){return i.sort(l)}),e.TgZ(5,"option",4),e._uU(6," Recent Uploads "),e.qZA(),e.TgZ(7,"option",5),e._uU(8," Oldest Uploads "),e.qZA()()()(),e.TgZ(9,"div",6)(10,"div",7),e.YNc(11,G,15,1,"div",8),e.ALo(12,"async"),e.qZA()(),e.TgZ(13,"app-modal",9)(14,"app-edit",10),e.NdJ("update",function(l){return i.onClipUpdate(l)}),e.ALo(15,"async"),e.qZA()()),2&t&&(e.xp6(5),e.Q6J("selected","asc"===i.videosSortOrder),e.xp6(2),e.Q6J("selected","desc"===i.videosSortOrder),e.xp6(4),e.Q6J("ngForOf",e.lcZ(12,5,i.clips$)),e.xp6(2),e.Q6J("id",i.EDIT_MODAL_ID),e.xp6(1),e.Q6J("clip",e.lcZ(15,7,i.activeClip$)))},directives:[g.yS,a.YN,a.Kr,p.sg,V.z,H],pipes:[p.Ov],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0}),n})();var X=s(127),W=s(8746),K=s(3103),ee=s(9841),te=s(7556);let ne=(()=>{class n{handleEvent(t){t.preventDefault()}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=e.lG2({type:n,selectors:[["","appEventBlocker",""]],hostBindings:function(t,i){1&t&&e.NdJ("drop",function(l){return i.handleEvent(l)})("dragover",function(l){return i.handleEvent(l)})}}),n})();const ie=function(n){return{"bg-indigo-400 border-indigo-400 border-solid":n}};function oe(n,r){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",5),e.NdJ("dragend",function(){return e.CHM(t),e.oxw().isDragOver=!1})("dragover",function(){return e.CHM(t),e.oxw().isDragOver=!0})("dragenter",function(){return e.CHM(t),e.oxw().isDragOver=!0})("dragleave",function(){return e.CHM(t),e.oxw().isDragOver=!1})("mouseleave",function(){return e.CHM(t),e.oxw().isDragOver=!1})("drop",function(o){return e.CHM(t),e.oxw().onFileDrop(o)}),e.TgZ(2,"h5"),e._uU(3,"Drop your file here (mp4 only!)"),e.qZA()(),e.TgZ(4,"input",6),e.NdJ("change",function(o){return e.CHM(t),e.oxw().onFileSelect(o)}),e.qZA(),e.BQk()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngClass",e.VKq(1,ie,t.isDragOver))}}function re(n,r){if(1&n&&(e.TgZ(0,"p"),e._uU(1),e.ALo(2,"percent"),e.qZA()),2&n){const t=r.$implicit;e.xp6(1),e.hij(" ",e.lcZ(2,1,t)," ")}}function le(n,r){if(1&n&&(e.TgZ(0,"app-alert",22)(1,"p"),e._uU(2),e.qZA(),e.YNc(3,re,3,3,"p",7),e.ALo(4,"async"),e.qZA()),2&n){const t=e.oxw().$implicit,i=e.oxw(2);e.Q6J("color",t.color),e.xp6(2),e.Oqu(t.msg),e.xp6(1),e.Q6J("ngIf",e.lcZ(4,3,i.uploadPercentage$))}}function se(n,r){if(1&n&&(e.ynx(0),e.YNc(1,le,5,5,"app-alert",21),e.BQk()),2&n){const t=r.$implicit;e.xp6(1),e.Q6J("ngIf",t.show)}}const ae=function(n,r){return{"opacity-50":n,"hover:bg-indigo-700":r}};function ce(n,r){if(1&n){const t=e.EpF();e.YNc(0,se,2,1,"ng-container",7),e.ALo(1,"async"),e.TgZ(2,"form",8),e.NdJ("ngSubmit",function(){return e.CHM(t),e.oxw().uploadFile()}),e.TgZ(3,"h2",9),e._uU(4,"Select a Thumbnail"),e.qZA(),e.TgZ(5,"div",10)(6,"div",11),e._UZ(7,"img",12),e.qZA(),e.TgZ(8,"div",13),e._UZ(9,"img",14),e.qZA(),e.TgZ(10,"div",13),e._UZ(11,"img",15),e.qZA()(),e.TgZ(12,"div",16)(13,"label",17),e._uU(14,"Title"),e.qZA(),e._UZ(15,"app-input",18),e.qZA(),e.TgZ(16,"div",19)(17,"button",20),e.ALo(18,"async"),e.ALo(19,"async"),e.ALo(20,"async"),e._uU(21," Publish "),e.qZA()()()}if(2&n){const t=e.oxw();e.Q6J("ngIf",e.lcZ(1,5,t.alert$)),e.xp6(2),e.Q6J("formGroup",t.uploadForm),e.xp6(13),e.Q6J("control",t.title),e.xp6(2),e.Q6J("disabled",e.lcZ(18,7,t.isProcessingRequest$))("ngClass",e.WLB(13,ae,e.lcZ(19,9,t.isProcessingRequest$),!1===e.lcZ(20,11,t.isProcessingRequest$)))}}const de=[{path:"manage",component:z},{path:"upload",component:(()=>{class n{constructor(t,i,o){this.authService=t,this.clipService=i,this.router=o,this.CLIP_UPLOADING_MESSAGE="Please wait! Your clip is being uploaded",this.isDragOver=!1,this.file=null,this.user=null,this.alert$=new f.x,this.formEnabled=!1,this.title=new a.NI("",[a.kI.required,a.kI.minLength(3)]),this.uploadForm=new a.cw({title:this.title}),this.isProcessingRequest$=new f.x,this.uploadPercentage$=null,this.uploadTask=null,this.authService.user$.subscribe(l=>this.user=l)}ngOnDestroy(){this.uploadTask&&this.uploadTask.cancel()}onFileDrop(t){var i,o;this.isDragOver=!1;const l=null!==(o=null===(i=t.dataTransfer)||void 0===i?void 0:i.files[0])&&void 0!==o?o:null;this.setFile(l)}onFileSelect(t){var i,o;const l=null!==(o=null===(i=t.target.files)||void 0===i?void 0:i[0])&&void 0!==o?o:null;this.setFile(l)}setFile(t){var i;if(t){if(this.file=t,"video/mp4"!==this.file.type)return void console.log("Nam data is: ",null===(i=this.file)||void 0===i?void 0:i.type);this.title.setValue(this.file.name.replace(/\.[^/.]+$/,"")),this.formEnabled=!0}}uploadFile(){var t=this;if(!this.file)return;this.uploadForm.disable(),this.alert$.next({show:!0,color:"blue",msg:this.CLIP_UPLOADING_MESSAGE}),this.isProcessingRequest$.next(!0);const[i,o]=this.clipService.uploadClip(this.file);var l;this.uploadTask=i,this.uploadPercentage$=this.uploadTask.percentageChanges().pipe((0,h.U)(l=>l?l/100:0),(0,W.x)(()=>this.uploadPercentage$=null)),this.uploadTask.snapshotChanges().pipe((0,K.Z)(),(0,_.w)(()=>(0,ee.a)([o.getMetadata(),o.getDownloadURL()]))).subscribe({next:(l=(0,w.Z)(function*([d,u]){var m,y,b,Z;const ge={uid:null!==(y=null===(m=t.user)||void 0===m?void 0:m.uuid)&&void 0!==y?y:"unknow",displayName:null!==(Z=null===(b=t.user)||void 0===b?void 0:b.name)&&void 0!==Z?Z:"unknow user displayName",title:t.title.value,fileName:d.name,url:u,timestamp:X.Z.firestore.FieldValue.serverTimestamp()},me=yield t.clipService.createClip(ge);setTimeout(()=>{t.router.navigate(["clips",me.id])},1e3),t.alert$.next({color:"green",msg:"Success! Your clip is now ready to be shared with the world.",show:!0})}),function(u){return l.apply(this,arguments)}),error:l=>{this.uploadForm.enable(),this.alert$.next({color:"red",msg:"Upload failed. Please try again later",show:!0}),console.log("Nam data is: ",l)}})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(te.e),e.Y36(C),e.Y36(g.F0))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-upload"]],decls:7,vars:2,consts:[[1,"container","mx-auto","my-8","bg-secondary","p-6"],[1,"rounded","relative","flex","flex-col"],[1,"font-bold","mb-6"],[4,"ngIf","ngIfElse"],["uploadFormTpl",""],["appEventBlocker","",1,"w-full","px-10","py-40","rounded","text-center","cursor-pointer","border","border-dashed","border-gray-400","transition","duration-500","hover:text-white","hover:bg-indigo-400","hover:border-indigo-400","hover:border-solid","text-xl",3,"ngClass","dragend","dragover","dragenter","dragleave","mouseleave","drop"],["type","file",1,"mt-4",3,"change"],[4,"ngIf"],[3,"formGroup","ngSubmit"],[1,"mb-4","text-xl"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-4"],[1,"border-8","cursor-pointer","border-green-400"],["src","assets/img/1.jpg"],[1,"border-8","cursor-pointer","border-transparent"],["src","assets/img/2.jpg"],["src","assets/img/3.jpg"],[1,"mt-4"],[1,"block","text-xl","mb-4"],["placeHolder","Enter title",3,"control"],[1,"mt-4","text-right"],["type","submit",1,"inline-flex","justify-center","py-2","px-4","border","border-transparent","shadow-sm","rounded-md","text-white","bg-indigo-600","focus:outline-none",3,"disabled","ngClass"],[3,"color",4,"ngIf"],[3,"color"]],template:function(t,i){if(1&t&&(e.TgZ(0,"section",0)(1,"div",1)(2,"div",2),e._uU(3,"Upload Video"),e.qZA(),e.YNc(4,oe,5,3,"ng-container",3),e.YNc(5,ce,22,16,"ng-template",null,4,e.W1O),e.qZA()()),2&t){const o=e.MAs(6);e.xp6(4),e.Q6J("ngIf",!i.formEnabled)("ngIfElse",o)}},directives:[p.O5,ne,p.mk,U.w,a._Y,a.JL,a.sg,I.a],pipes:[p.Ov,p.Zx],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0}),n})()},{path:"manage-clips",redirectTo:"manage"}];let pe=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[g.Bz.forChild(de)],g.Bz]}),n})(),ue=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[p.ez,pe,A.m,a.UX]]}),n})()}}]);